{# Custom template for Main navigation menu (machine name: main) #}
{% import _self as menus %}

{% macro render_menu(items, attributes, menu_level) %}
{% if items %}
{# Top level menu gets Bootstrap nav classes #}
<ul{{ attributes.addClass(menu_level==0 ? ['navbar-nav', 'ms-auto' , 'mb-2' , 'mb-lg-0' ] : ['dropdown-menu']) }}>
  {% for item in items %}
  {% set has_children = item.below is not empty %}
  {% set li_classes = [
  menu_level == 0 ? 'nav-item' : '',
  has_children and menu_level == 0 ? 'dropdown' : ''
  ] %}

  <li{{ item.attributes.addClass(li_classes) }}>
    {% set link_classes = [
    menu_level == 0 ? 'nav-link' : 'dropdown-item',
    has_children and menu_level == 0 ? 'dropdown-toggle' : null,
    item.in_active_trail ? 'active' : null
    ] %}


    {% if has_children and menu_level == 0 %}
    <a href="{{ item.url }}" class="{{ link_classes|join(' ') }}" role="button" data-bs-toggle="dropdown"
      aria-expanded="false">
      {{ item.title }}
    </a>
    {% else %}
    {{ link(item.title, item.url, {'class': link_classes}) }}
    {% endif %}

    {# Render sub-menu if present #}
    {% if has_children %}
    {{ menus.render_menu(item.below, attributes.removeClass('navbar-nav'), menu_level + 1) }}
    {% endif %}
    </li>
    {% endfor %}
    </ul>
    {% endif %}
    {% endmacro %}

    {{ menus.render_menu(items, attributes, 0) }}